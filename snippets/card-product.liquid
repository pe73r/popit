{%- if card_product and card_product != empty -%} 
  <div class="card-product p-5 rounded-md bg-white shadow-md {% unless template contains "collection" or width_fit == true %} hehe min-w-[300px] md:min-w-[320px] {% endunless %}">
    <a href="{{ card_product.url }}">
      <div class="flex items-center">
         <!-- card info -->
          <div class="w-7/12 text-left">

            <!-- Title and drop -->
            <div class="flex gap-1 relative min-h-[60px]">
              <{% if template contains 'collection' %}h2{% else %}h3{% endif %} class="font-body-text text-[20px] font-extrabold line-clamp-2">
                {{ card_product.title }}
              </{% if template contains 'collection' %}h2{% else %}h3{% endif %}>

              {%- if card_product.tags contains "rouge" -%}
                <div class="relative top-1">
                  {% render 'icon-drop-red' %}
                </div>
              {%- elsif card_product.tags contains "blanc" -%}
                  <div class="relative top-1">
                    {% render 'icon-drop-yellow' %}
                  </div>
              {%- endif -%}
            </div>

            <!-- Avis verifiés  -->
            <div class="min-h-[15px]">

            </div>

            <!-- Metafield producer -->
            <div class="mt-5">
              <p class="text-xs uppercase font-light">PRODUCTEUR</p>
              <p class="text-base line-clamp-2 min-h-[32px]">Laguerre (Domaine)</p>
              {%- comment -%} <p class="my-2 text-base line-clamp-1 max-h-[32px]">{{ card_product.metafields.product.producer  }}</p> {%- endcomment -%}
            </div>

            <!-- Metafield region -->
            <div class="mt-3">
              <p class="text-xs uppercase font-light">RÉGION</p>
              <p class="text-base line-clamp-1">Bourgogne</p>
              {%- comment -%} <p class="my-2 text-base line-clamp-1 max-h-[32px]">{{ card_product.metafields.product.region }}</p> {%- endcomment -%}
            </div>

            <!-- Metafield grade -->
            <div class="mt-3">
              <p class="text-xs uppercase font-light">CÉPAGE</p>
              <p class="text-base line-clamp-1">Syrah</p>
              {%- comment -%} <p class="my-2 text-base line-clamp-1 max-h-[32px]">{{ card_product.metafields.product.grade }}</p> {%- endcomment -%}
            </div>
        </div>

          <!-- product image -->
         <div class="w-5/12 relative group">
            {%- if card_product.featured_media -%}
                <div class="w-full {% if card_product.media[1] != nil and show_secondary_image %} card_product__image transition-all md:group-hover:opacity-0 {% endif %}  ">
                    <img
                      srcset="{%- if card_product.featured_media.width >= 165 -%}{{ card_product.featured_media | image_url: width: 165 }} 165w,{%- endif -%}
                        {%- if card_product.featured_media.width >= 360 -%}{{ card_product.featured_media | image_url: width: 360 }} 360w,{%- endif -%}
                        {%- if card_product.featured_media.width >= 533 -%}{{ card_product.featured_media | image_url: width: 533 }} 533w,{%- endif -%}
                        {%- if card_product.featured_media.width >= 720 -%}{{ card_product.featured_media | image_url: width: 720 }} 720w,{%- endif -%}
                        {%- if card_product.featured_media.width >= 940 -%}{{ card_product.featured_media | image_url: width: 940 }} 940w,{%- endif -%}
                        {%- if card_product.featured_media.width >= 1066 -%}{{ card_product.featured_media | image_url: width: 1066 }} 1066w,{%- endif -%}
                        {{ card_product.featured_media | image_url }} {{ card_product.featured_media.width }}w"
                      src="{{ card_product.featured_media | image_url: width: 533 }}"
                      sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
                      alt="{{ card_product.featured_media.alt | escape }}"
                      class="motion-reduce"
                      {% unless lazy_load == false %}loading="lazy"{% endunless %}
                      width="{{ card_product.featured_media.width }}"
                      height="{{ card_product.featured_media.height }}"
                    >
                </div>
                {%- if card_product.media[1] != nil and show_secondary_image -%}
                  <div class="absolute top-0 z-10 hidden object-cover h-full transition-all bg-white opacity-0 md:block md:group-hover:opacity-100 ">
                      <img
                        srcset="{%- if card_product.media[1].width >= 165 -%}{{ card_product.media[1] | image_url: width: 165 }} 165w,{%- endif -%}
                          {%- if card_product.media[1].width >= 360 -%}{{ card_product.media[1] | image_url: width: 360 }} 360w,{%- endif -%}
                          {%- if card_product.media[1].width >= 533 -%}{{ card_product.media[1] | image_url: width: 533 }} 533w,{%- endif -%}
                          {%- if card_product.media[1].width >= 720 -%}{{ card_product.media[1] | image_url: width: 720 }} 720w,{%- endif -%}
                          {%- if card_product.media[1].width >= 940 -%}{{ card_product.media[1] | image_url: width: 940 }} 940w,{%- endif -%}
                          {%- if card_product.media[1].width >= 1066 -%}{{ card_product.media[1] | image_url: width: 1066 }} 1066w,{%- endif -%}
                          {{ card_product.media[1] | image_url }} {{ card_product.media[1].width }}w"
                        src="{{ card_product.media[1] | image_url: width: 533 }}"
                        sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
                        alt="{{ card_product.media[1].alt | escape }}"
                        class="w-full h-full motion-reduce"
                        loading="lazy"
                        width="{{ card_product.media[1].width }}"
                        height="{{ card_product.media[1].height }}"
                      >
                  </div>
                {%- endif -%}
           {%- endif -%}
        </div>
      </div> <!-- close flex -->
    </a>


    <div class="border-t pt-2 mt-4">
      <!-- Price -->
      <div class="flex items-center">
        {% if card_product.compare_at_price == nil %}
            <span class="text-[20px] font-extrabold">
                {{ card_product.price | money }}
            </span>
        {% else %}
          <span class="text-[20px] font-extrabold">
              {{ card_product.price | money }}
          </span>
            <span class="line-through text-base ml-2">
                {{ card_product.compare_at_price | money }}
            </span>
        {% endif %}
      </div>

       <!-- cta  -->
      {% if card_product.available %}
          <div class="group relative mt-3 flex gap-1">
            <product-quantity
            data-max-quantity="{{card_product.selected_or_first_available_variant.inventory_quantity}}"
            data-product="{{card_product.id}}" 
            class="flex items-center justify-center m-auto quantity border border-gray-300 rounded-md py-[5px] px-2">
              <button class= "p-1 no-js-hidden" name="minus" type="button">
                {% render 'icon-quantity-minus' %}
              </button>
              <input class="text-black bg-transparent text-[16px] md:text-[20px] font-extrabold md:max-w-[30px] max-w-[20px] text-center"
                  type="number"
                  name="quantity"
                  id="Quantity-{{ section.id }}"
                  min="1"
                  value="1"
                  form="{{ product_form_id }}"
                >
              <button  class="p-1 no-js-hidden" name="plus" type="button">
                {% render 'icon-quantity-plus' %}
              </button>
            </product-quantity>

            <add-to-cart
              data-max-quantity={{card_product.selected_or_first_available_variant.inventory_quantity}}
              class="w-8/12 "
                data-product="{{ card_product.id }}"
                data-title="{{ card_product.title }}{% unless card_product.selected_or_first_available_variant.title contains 'Default' %} - {{ card_product.selected_or_first_available_variant.title }}{% endunless %}"
                data-discount="{% if card_product.selected_or_first_available_variant.compare_at_price > card_product.selected_or_first_available_variant.price %}{{ card_product.selected_or_first_available_variant.compare_at_price | minus: card_product.selected_or_first_available_variant.price | divided_by: 100.00 }}{% else %}0.00{% endif %}"
                data-price="{{ card_product.selected_or_first_available_variant.price | divided_by: 100.00 }}"
                data-variant="{{ card_product.selected_or_first_available_variant.id }}">
                <button class="btn-primary {% render "button", size:"small", color:"primary", color:"primary", fullWidth: true %}">
                    Ajouter au panier
                </button>
            </add-to-cart>
          </div>
        {% else %}
            <div class="relative mt-3" data-variant="{{ product.selected_or_first_available_variant.id }}">
              <div class="bg-gray-medium text-black text-center font-normal text-sm {% render "button", size:"small", color:"gray-medium", fullWidth: true %}">
                Rupture
              </div>
            </div>
      {% endif %}
    </div>

  </div>
{%- endif -%}
